<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>
        <menuitem id="work_order_root_menu"
                  name="Work-Order"
                  parent="work_order_root"
                  sequence="2"/>

        <!-- Tags -->
        <record id="work_order_tags_search_view" model="ir.ui.view">
            <field name="name">Tags</field>
            <field name="model">work.order.tags</field>
            <field name="arch" type="xml">
                <search string="Tags">
                    <field name="name"/>
                </search>
            </field>
        </record>

        <record id="work_order_tags_form_view" model="ir.ui.view">
            <field name="name">Tags</field>
            <field name="model">work.order.tags</field>
            <field name="arch" type="xml">
                <form string="Tags">
                    <sheet>
                        <group>
                            <field name="name"/>
                        </group>
                    </sheet>
                </form>
            </field>
        </record>

        <record id="work_order_tags_tree_view" model="ir.ui.view">
            <field name="name">Tags</field>
            <field name="model">work.order.tags</field>
            <field name="arch" type="xml">
                <tree string="Tags" editable="bottom">
                    <field name="name"/>
                </tree>
            </field>
        </record>

        <record id="work_order_tags_action" model="ir.actions.act_window">
            <field name="name">Tags</field>
            <field name="res_model">work.order.tags</field>
            <field name="help" type="html">
                <p class="o_view_nocontent_smiling_face">
                    Create a new tag
                </p>
            </field>
        </record>

        <menuitem action="work_order_tags_action" id="menu_work_order_tags_act" parent="work_order_configuration"/>

        <!-- Work-Order Stages-->
        <record id="work_order_stage_form" model="ir.ui.view">
            <field name="name">work_order_stage_form</field>
            <field name="model">work.order.stage</field>
            <field name="arch" type="xml">
                <form string="Work Order Stage">
                    <sheet>
                        <group>
                            <group>
                                <field name="name"/>
                                <field name="sequence"/>
                            </group>
                        </group>
                        <group>
                            <field name="description"/>
                        </group>
                    </sheet>
                </form>
            </field>
        </record>

        <record id="work_order_stage_kanban" model="ir.ui.view">
            <field name="name">work_order_stage_kanban</field>
            <field name="model">work.order.stage</field>
            <field name="arch" type="xml">
                <kanban class="o_kanban_mobile">
                    <field name="name"/>
                    <field name="description"/>
                    <templates>
                        <t t-name="kanban-box">
                            <div t-attf-class="oe_kanban_global_click">
                                <div class="row">
                                    <div class="col-12">
                                        <strong>
                                            <t t-esc="record.name.value"/>
                                        </strong>
                                    </div>
                                </div>
                                <t t-if="record.description.value">
                                    <hr class="mt8 mb8"/>
                                    <t t-esc="record.description.value"/>
                                </t>
                            </div>
                        </t>
                    </templates>
                </kanban>
            </field>
        </record>

        <record id="work_order_stage_tree" model="ir.ui.view">
            <field name="name">work_order_stage_tree</field>
            <field name="model">work.order.stage</field>
            <field name="arch" type="xml">
                <tree string="Work Order Stages">
                    <field name="sequence" widget="handle"/>
                    <field name="name"/>
                    <field name="description"/>
                    <field name="active"/>
                </tree>
            </field>
        </record>

        <record id="work_order_stage_action" model="ir.actions.act_window">
            <field name="name">Work Order Stage</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">work.order.stage</field>
            <field name="view_mode">tree,kanban,form</field>
            <field name="view_id" ref="work_order_stage_tree"/>
            <field name="help" type="html">
                <p class="o_view_nocontent_smiling_face">
                    Create a new stage in the Work Order pipeline
                </p>
                <p>
                    Define the steps that will be used in the Work Order from the
                    creation of the task, up to the closing of the task or issue.
                    You will use these stages in order to track the progress in
                    solving a task or an issue.
                </p>
            </field>
        </record>

        <menuitem id="work_order_stage_menu" name="Stages" action="work_order_stage_action"
                  parent="work_order_configuration"/>

        <!-- Work-Order inspect-->
        <record id="work_order_inspect_view_search" model="ir.ui.view">
            <field name="name">work_order_inspect_view_search</field>
            <field name="model">work.order.inspect</field>
            <field name="arch" type="xml">
                <search string="Work-Order Inspect">
                    <field name="name"/>
                    <field name="user_id"/>
                    <field name="partner_id" operator="child_of"/>
                    <field name="machine_id"/>
                    <field name="state"/>
                    <filter string="My inspect" name="my_tasks" domain="[('user_id', '=', uid)]"/>
                    <filter string="Unassigned" name="unassigned" domain="[('user_id', '=', False)]"/>
                    <group expand="0" string="Group By">
                        <filter string="State" name="stage" context="{'group_by': 'state'}"/>
                        <filter string="Assigned to" name="user" context="{'group_by': 'user_id'}"/>
                    </group>
                </search>
            </field>
        </record>

        <record id="work_order_inspect_tree" model="ir.ui.view">
            <field name="name">work_order_inspect_view_tree</field>
            <field name="model">work.order.inspect</field>
            <field name="arch" type="xml">
                <tree string="Work-Order Inspect">
                    <field name="name"/>
                    <field name="inspect_date"/>
                    <field name="work_order_id"/>
                    <field name="machine_id"/>
                    <field name="partner_id"/>
                    <field name="user_id"/>
                    <field name="state"/>
                </tree>
            </field>
        </record>

        <record id="work_order_inspect_form" model="ir.ui.view">
            <field name="name">work_order_inspect_view_form</field>
            <field name="model">work.order.inspect</field>
            <field name="arch" type="xml">
                <form string="Work-Order Inspect">
                    <header>
                        <field name="state" widget="statusbar"/>
                    </header>
                    <sheet>
                        <div class="oe_title">
                            <h3>
                                <field name="name" readonly="1"/>
                            </h3>
                        </div>
                         <group>
                            <group>
                                <field name="work_order_id"/>
                                <field name="partner_id"/>
                                <field name="machine_id"/>
                            </group>
                            <group>
                                <field name="inspect_date"/>
                                <field name="date_assign"/>
                                <field name="user_id"/>
                            </group>
                        </group>
                        <notebook>
                            <page string="Description">
                                <field name="description"/>
                            </page>
                        </notebook>

                    </sheet>
                    <div class="oe_chatter">
                        <field name="message_follower_ids" widget="mail_followers"/>
                        <field name="activity_ids" widget="mail_activity"/>
                        <field name="message_ids" widget="mail_thread"/>
                    </div>
                </form>
            </field>
        </record>

        <record id="work_order_inspect_action" model="ir.actions.act_window">
            <field name="name">Work-Order Inspect</field>
            <field name="res_model">work.order.inspect</field>
            <field name="type">ir.actions.act_window</field>
            <field name="view_mode">tree,form</field>
            <field name="context">{}</field>
            <field name="help" type="html">
                <p class="o_view_nocontent_smiling_face">
                    Create a new Work Order Inspect
                </p>
            </field>
        </record>

        <menuitem id="work_order_inspect_menu"
                  name="Inspection"
                  parent="work_order_root_menu"
                  action="work_order_inspect_action" sequence="2"/>

        <!-- Work-Order -->
        <record id="work_order_view_search" model="ir.ui.view">
            <field name="name">work_order_view_search</field>
            <field name="model">work.order</field>
            <field name="arch" type="xml">
                <search string="Work-Order">
                    <field name="name" string="Task"/>
                    <field name="tag_ids"/>
                    <field name="user_id"/>
                    <field name="partner_id" operator="child_of"/>
                    <field name="stage_id"/>
                    <filter string="My Tasks" name="my_tasks" domain="[('user_id', '=', uid)]"/>
                    <filter string="Unassigned" name="unassigned" domain="[('user_id', '=', False)]"/>
                    <group expand="0" string="Group By">
                        <filter string="Stage" name="stage" context="{'group_by': 'stage_id'}"/>
                        <filter string="Assigned to" name="user" context="{'group_by': 'user_id'}"/>
                    </group>
                </search>
            </field>
        </record>

        <record id="work_order_view_tree" model="ir.ui.view">
            <field name="name">work_order_view_tree</field>
            <field name="model">work.order</field>
            <field name="arch" type="xml">
                <tree string="work_order_tree">
                    <field name="name"/>
                    <field name="order_date"/>
                    <field name="machine_id"/>
                    <field name="partner_id"/>
                    <field name="user_id"/>
                    <field name="priority"/>
                    <field name="stage_id"/>
                </tree>
            </field>
        </record>

        <record id="work_order_view_form" model="ir.ui.view">
            <field name="name">work_order_view_form</field>
            <field name="model">work.order</field>
            <field name="arch" type="xml">
                <form string="work_order_form">
                    <header>
                        <field name="stage_id" widget="statusbar" options="{'clickable': '1'}"/>
                    </header>
                    <sheet string="Work-Order">
                        <div class="oe_button_box" name="button_box">
                            <button name="action_view_inspect" type="object" class="oe_stat_button"
                                    icon="fa-pencil-square-o">
                                <field name="order_inspect_count" widget="statinfo" string="Inspections"/>
                            </button>
                        </div>

                        <div class="oe_title">
                            <h3>
                                <field name="name" readonly="1"/>
                            </h3>
                        </div>

                        <group>
                            <group>
                                <field name="partner_id"/>
                                <field name="machine_id"/>
                                <field name="user_id"/>
                                <field name="date_assign"/>
                            </group>
                            <group>
                                <field name="priority" widget="priority"/>
                                <field name="tag_ids" widget="many2many_tags"/>
                                <field name="order_date"/>
                                <field name="date_end"/>
                            </group>
                        </group>
                        <notebook>
                            <page string="Description">
                                <field name="description"/>
                            </page>
                        </notebook>
                    </sheet>
                    <div class="oe_chatter">
                        <field name="message_follower_ids" widget="mail_followers"/>
                        <field name="activity_ids" widget="mail_activity"/>
                        <field name="message_ids" widget="mail_thread"/>
                    </div>
                </form>
            </field>
        </record>

        <record id="quick_create_work_order_form" model="ir.ui.view">
            <field name="name">workshop.work.order.form.quick_create</field>
            <field name="model">work.order</field>
            <field name="priority">1000</field>
            <field name="arch" type="xml">
                <form>
                    <group>
                        <field name="machine_id"/>
                        <field name="partner_id"/>
                    </group>
                </form>
            </field>
        </record>

        <record id="work_order_kanban" model="ir.ui.view">
            <field name="name">work.order</field>
            <field name="model">work.order</field>
            <field name="arch" type="xml">
                <kanban default_group_by="stage_id" class="o_kanban_small_column o_kanban_project_tasks"
                        on_create="quick_create" quick_create_view="workshop.quick_create_work_order_form"
                        examples="Work Order">
                    <field name="priority"/>
                    <field name="stage_id" options='{"group_by_tooltip": {"description": "Description"}}'/>
                    <field name="id"/>
                    <field name="name"/>
                    <field name="user_id"/>
                    <field name="partner_id"/>
                    <templates>
                        <t t-name="kanban-box">
                            <div t-attf-class="o_kanban_project_phases oe_kanban_global_click"
                                 t-attf-style="height:100px;">
                                <div class="oe_kanban_details">
                                    <div class="o_kanban_record_top">
                                        <h4 class="mt0 mb0">
                                            <field name="name"/>
                                        </h4>
                                    </div>
                                    <div class="o_kanban_record_body">
                                        <strong class="o_kanban_record_title">
                                            <field name="machine_id"/>
                                        </strong>
                                        <p class="o_kanban_record_title">
                                            <field name="partner_id"/>
                                        </p>
                                    </div>
                                    <div class="o_kanban_record_bottom" t-if="!selection_mode">
                                        <div class="oe_kanban_bottom_left">
                                            <field name="priority" widget="priority"/>
                                        </div>
                                        <div class="oe_kanban_bottom_right">
                                            <img t-att-src="kanban_image('res.users', 'image_128', record.user_id.raw_value)"
                                                 t-att-title="record.user_id.value" t-att-alt="record.user_id.value"
                                                 class="oe_kanban_avatar"/>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </t>
                    </templates>
                </kanban>
            </field>
        </record>

        <record id="work_order_action" model="ir.actions.act_window">
            <field name="name">Work-Order</field>
            <field name="res_model">work.order</field>
            <field name="type">ir.actions.act_window</field>
            <field name="view_mode">kanban,tree,pivot,graph,form</field>
            <field name="context">{}</field>
            <field name="help" type="html">
                <p class="o_view_nocontent_smiling_face">
                    Create a new Work Order
                </p>
                <p>
                    Odoo's project management allows you to manage the pipeline of your tasks efficiently.
                    <br/>
                    You can track progress, discuss on tasks, attach documents, etc.
                </p>
            </field>
        </record>

        <menuitem id="work_order_menu"
                  name="Work-Order"
                  parent="work_order_root_menu"
                  action="work_order_action" sequence="2"/>
    </data>
</odoo>